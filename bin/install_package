#!/usr/bin/env bash

trap 'exit' ERR
set -E

# Unpack, validate the digests, and install the named package.
main() {
    local tembo_pkg arch dest
    tembo_pkg=${1-}

    # Maker sure we have the tembo package argument.
    if [ -z "$tembo_pkg" ]; then
        usage
        exit 2
    fi

    dest=/var/lib/postgresql/data/lib
    arch="$(dpkg --print-architecture)"
    tar zxvf "tembo-${tembo_pkg}_${arch}.tgz"
    cd "tembo-${tembo_pkg}_${arch}" || exit
    sha512sum --check --strict digests
    mkdir -p "$dest"
    cp -p --recursive --update --verbose "lib/"* "$dest/"
}

main "$@"
